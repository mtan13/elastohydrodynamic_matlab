function out=YWdefsolve7()

hold on
hold all


allruns = zeros(400,1);
tincre=0.5;% time increment
maxratio = 0;


thicknessmax = 40*1e-6;

vars = [335570.4698 16442953.02 thicknessmax];
miu = vars(1, 1);
lambda = vars(1, 2);
h = vars(1, 3);


ratio = 0.9;
maxratio = 0.9;
%eta=[9.6E-4; 9.6E-4/5;9.6E-4/20]; %Pa.s
eta=.194;% unit: pa.s
R=0.014;% Radius of curvature
viscosity = 0.15E7;
k=165.31; %LCL-854 omega, spring constant
v=-137E-9;% drive velocity
hinitial=0.0000002366;
time=0;
poi=.5;
E=1.00E6;
Rs=[0
0.000002
0.000004
0.000006
0.000008
0.00001
0.000012
0.000014
0.000016
0.000018
0.00002
0.000022
0.000024
0.000026
0.000028
0.00003
0.000032
0.000034
0.000036
0.000038
0.00004
0.000042
0.000044
0.000046
0.000048
0.00005
0.000052
0.000054
0.000056
0.000058
0.00006
0.000062
0.000064
0.000066
0.000068
0.00007
0.000072
0.000074
0.000076
0.000078
0.00008
0.000082
0.000084
0.000086
0.000088
0.00009
0.000092
0.000094
0.000096
0.000098
0.0001
0.000102
0.000104
0.000106
0.000108
0.00011
0.000112
0.000114
0.000116
0.000118
0.00012
0.000122
0.000124
0.000126
0.000128
0.00013
0.000132
0.000134
0.000136
0.000138
0.00014
0.000142
0.000144
0.000146
0.000148
0.00015
0.000152
0.000154
0.000156
0.000158
0.00016
0.000162
0.000164
0.000166
0.000168
0.00017
0.000172
0.000174
0.000176
0.000178
0.00018
0.000182
0.000184
0.000186
0.000188
0.00019
0.000192
0.000194
0.000196
0.000198
0.0002
0.000202
0.000204
0.000206
0.000208
0.00021
0.000212
0.000214
0.000216
0.000218
0.00022
0.000222
0.000224
0.000226
0.000228
0.00023
0.000232
0.000234
0.000236
0.000238
0.00024
0.000242
0.000244
0.000246
0.000248
0.00025
0.000252
0.000254
0.000256
0.000258
0.00026
0.000262
0.000264
0.000266
0.000268
0.00027
0.000272
0.000274
0.000276
0.000278
0.00028
0.000282
0.000284
0.000286
0.000288
0.00029
0.000292
0.000294
0.000296
0.000298
0.0003
0.000302
0.000304
0.000306
0.000308
0.00031
0.000312
0.000314
0.000316
0.000318
0.00032
0.000322
0.000324
0.000326
0.000328
0.00033
0.000332
0.000334
0.000336
0.000338
0.00034
0.000342
0.000344
0.000346
0.000348
0.00035
0.000352
0.000354
0.000356
0.000358
0.00036
0.000362
0.000364
0.000366
0.000368
0.00037
0.000372
0.000374
0.000376
0.000378
0.00038
0.000382
0.000384
0.000386
0.000388
0.00039
0.000392
0.000394
0.000396
0.000398
0.0004
0.000402
0.000404
0.000406
0.000408
0.00041
0.000412
0.000414
0.000416
0.000418
0.00042
0.000422
0.000424
0.000426
0.000428
0.00043
0.000432
0.000434
0.000436
0.000438
0.00044
0.000442
0.000444
0.000446
0.000448
0.00045
0.000452
0.000454
0.000456
0.000458
0.00046
0.000462
0.000464
0.000466
0.000468
0.00047
0.000472
0.000474
0.000476
0.000478
0.00048
0.000482
0.000484
0.000486
0.000488
0.00049
0.000492
0.000494
0.000496
0.000498
0.0005
0.000502
0.000504
0.000506
0.000508
0.00051
0.000512
0.000514
0.000516
0.000518
0.00052
0.000522
0.000524
0.000526
0.000528
0.00053
0.000532
0.000534
0.000536
0.000538
0.00054
0.000542
0.000544
0.000546
0.000548
0.00055
0.000552
0.000554
0.000556
0.000558
0.00056
0.000562
0.000564
0.000566
0.000568
0.00057
0.000572
0.000574
0.000576
0.000578
0.00058
0.000582
0.000584
0.000586
0.000588
0.00059
0.000592
0.000594
0.000596
0.000598
0.0006
0.000602
0.000604
0.000606
0.000608
0.00061
0.000612
0.000614
0.000616
0.000618
0.00062
0.000622
0.000624
0.000626
0.000628
0.00063
0.000632
0.000634
0.000636
0.000638
0.00064
0.000642
0.000644
0.000646
0.000648
0.00065
0.000652
0.000654
0.000656
0.000658
0.00066
0.000662
0.000664
0.000666
0.000668
0.00067
0.000672
0.000674
0.000676
0.000678
0.00068
0.000682
0.000684
0.000686
0.000688
0.00069
0.000692
0.000694
0.000696
0.000698
0.0007
0.000702
0.000704
0.000706
0.000708
0.00071
0.000712
0.000714
0.000716
0.000718
0.00072
0.000722
0.000724
0.000726
0.000728
0.00073
0.000732
0.000734
0.000736
0.000738
0.00074
0.000742
0.000744
0.000746
0.000748
0.00075
0.000752
0.000754
0.000756
0.000758
0.00076
0.000762
0.000764
0.000766
0.000768
0.00077
0.000772
0.000774
0.000776
0.000778
0.00078
0.000782
0.000784
0.000786
0.000788
0.00079
0.000792
0.000794
0.000796
0.000798
0.0008
0.000802
0.000804
0.000806
0.000808
0.00081
0.000812
0.000814
0.000816
0.000818
0.00082
0.000822
0.000824
0.000826
0.000828
0.00083
0.000832
0.000834
0.000836
0.000838
0.00084
0.000842
0.000844
0.000846
0.000848
0.00085
0.000852
0.000854
0.000856
0.000858
0.00086
0.000862
0.000864
0.000866
0.000868
0.00087
0.000872
0.000874
0.000876
0.000878
0.00088
0.000882
0.000884
0.000886
0.000888
0.00089
0.000892
0.000894
0.000896
0.000898
0.0009
0.000902
0.000904
0.000906
0.000908
0.00091
0.000912
0.000914
0.000916
0.000918
0.00092
0.000922
0.000924
0.000926
0.000928
0.00093
0.000932
0.000934
0.000936
0.000938
0.00094
0.000942
0.000944
0.000946
0.000948
0.00095
0.000952
0.000954
0.000956
0.000958
0.00096
0.000962
0.000964
0.000966
0.000968
0.00097
0.000972
0.000974
0.000976
0.000978
0.00098
0.000982
0.000984
0.000986
0.000988
0.00099
0.000992
0.000994
0.000996
0.000998
0.001
0.001002
0.001004
0.001006
0.001008
0.00101
0.001012
0.001014
0.001016
0.001018
0.00102
0.001022
0.001024
0.001026
0.001028
0.00103
0.001032
0.001034
0.001036
0.001038
0.00104
0.001042
0.001044
0.001046
0.001048
0.00105
0.001052
0.001054
0.001056
0.001058
0.00106
0.001062
0.001064
0.001066
0.001068
0.00107
0.001072
0.001074
0.001076
0.001078
0.00108
0.001082
0.001084
0.001086
0.001088
0.00109
0.001092
0.001094
0.001096
0.001098
0.0011
0.001102
0.001104
0.001106
0.001108
0.00111
0.001112
0.001114
0.001116
0.001118
0.00112
0.001122
0.001124
0.001126
0.001128
0.00113
0.001132
0.001134
0.001136
0.001138
0.00114
0.001142
0.001144
0.001146
0.001148
0.00115
0.001152
0.001154
0.001156
0.001158
0.00116
0.001162
0.001164
0.001166
0.001168
0.00117
0.001172
0.001174
0.001176
0.001178
0.00118
0.001182
0.001184
0.001186
0.001188
0.00119
0.001192
0.001194
0.001196
0.001198
0.0012
0.001202
0.001204
0.001206
0.001208
0.00121
0.001212
0.001214
0.001216
0.001218
0.00122
0.001222
0.001224
0.001226
0.001228
0.00123
0.001232
0.001234
0.001236
0.001238
0.00124
0.001242
0.001244
0.001246
0.001248
0.00125
0.001252
0.001254
0.001256
0.001258
0.00126
0.001262
0.001264
0.001266
0.001268
0.00127
0.001272
0.001274
0.001276
0.001278
0.00128
0.001282
0.001284
0.001286
0.001288
0.00129
0.001292
0.001294
0.001296
0.001298
0.0013
0.001302
0.001304
0.001306
0.001308
0.00131
0.001312
0.001314
0.001316
0.001318
0.00132
0.001322
0.001324
0.001326
0.001328
0.00133
0.001332
0.001334
0.001336
0.001338
0.00134
0.001342
0.001344
0.001346
0.001348
0.00135
0.001352
0.001354
0.001356
0.001358
0.00136
0.001362
0.001364
0.001366
0.001368
0.00137
0.001372
0.001374
0.001376
0.001378
0.00138
0.001382
0.001384
0.001386
0.001388
0.00139
0.001392
0.001394
0.001396
0.001398
0.0014
0.001402
0.001404
0.001406
0.001408
0.00141
0.001412
0.001414
0.001416
0.001418
0.00142
0.001422
0.001424
0.001426
0.001428
0.00143
0.001432
0.001434
0.001436
0.001438
0.00144
0.001442
0.001444
0.001446
0.001448
0.00145
0.001452
0.001454
0.001456
0.001458
0.00146
0.001462
0.001464
0.001466
0.001468
0.00147
0.001472
0.001474
0.001476
0.001478
0.00148
0.001482
0.001484
0.001486
0.001488
0.00149
0.001492
0.001494
0.001496
0.001498
0.0015
0.001502
0.001504
0.001506
0.001508
0.00151
0.001512
0.001514
0.001516
0.001518
0.00152
0.001522
0.001524
0.001526
0.001528
0.00153
0.001532
0.001534
0.001536
0.001538
0.00154
0.001542
0.001544
0.001546
0.001548
0.00155
0.001552
0.001554
0.001556
0.001558
0.00156
0.001562
0.001564
0.001566
0.001568
0.00157
0.001572
0.001574
0.001576
0.001578
0.00158
0.001582
0.001584
0.001586
0.001588
0.00159
0.001592
0.001594
0.001596
0.001598
0.0016
0.001602
0.001604
0.001606
0.001608
0.00161
0.001612
0.001614
0.001616
0.001618
0.00162
0.001622
0.001624
0.001626
0.001628
0.00163
0.001632
0.001634
0.001636
0.001638
0.00164
0.001642
0.001644
0.001646
0.001648
0.00165
0.001652
0.001654
0.001656
0.001658
0.00166
0.001662
0.001664
0.001666
0.001668
0.00167
0.001672
0.001674
0.001676
0.001678
0.00168
0.001682
0.001684
0.001686
0.001688
0.00169
0.001692
0.001694
0.001696
0.001698
0.0017
0.001702
0.001704
0.001706
0.001708
0.00171
0.001712
0.001714
0.001716
0.001718
0.00172
0.001722
0.001724
0.001726
0.001728
0.00173
0.001732
0.001734
0.001736
0.001738
0.00174
0.001742
0.001744
0.001746
0.001748
0.00175
0.001752
0.001754
0.001756
0.001758
0.00176
0.001762
0.001764
0.001766
0.001768
0.00177
0.001772
0.001774
0.001776
0.001778
0.00178
0.001782
0.001784
0.001786
0.001788
0.00179
0.001792
0.001794
0.001796
0.001798
0.0018
0.001802
0.001804
0.001806
0.001808
0.00181
0.001812
0.001814
0.001816
0.001818
0.00182
0.001822
0.001824
0.001826
0.001828
0.00183
0.001832
0.001834
0.001836
0.001838
0.00184
0.001842
0.001844
0.001846
0.001848
0.00185
0.001852
0.001854
0.001856
0.001858
0.00186
0.001862
0.001864
0.001866
0.001868
0.00187
0.001872
0.001874
0.001876
0.001878
0.00188
0.001882
0.001884
0.001886
0.001888
0.00189
0.001892
0.001894
0.001896
0.001898
0.0019
0.001902
0.001904
0.001906
0.001908
0.00191
0.001912
0.001914
0.001916
0.001918
0.00192
0.001922
0.001924
0.001926
0.001928
0.00193
0.001932
0.001934
0.001936
0.001938
0.00194
0.001942
0.001944
0.001946
0.001948
0.00195
0.001952
0.001954
0.001956
0.001958
0.00196
0.001962
0.001964
0.001966
0.001968
0.00197
0.001972
0.001974
0.001976
0.001978
0.00198
0.001982
0.001984
0.001986
0.001988
0.00199
0.001992
0.001994
0.001996
0.001998
0.002
0.002002
0.002004
0.002006
0.002008
]';
%Rs=[0:5E-6:300E-6 320E-6:R/400:R/10];
 %defines radius initialization
hpass1=hinitial;
allforce=zeros(400,1);
allhvst=zeros(400,length(Rs));
allwvst=allhvst;
allpvst=allhvst;
allevst=zeros(400,length(Rs));
allpevst=zeros(400,length(Rs));
hguess1=zeros(1,length(Rs));% this variable is the guess of new position 
p1=zeros(1,length(Rs));
p1guess=zeros(1,length(Rs));
hcalc=p1guess;
wguess=p1guess;

allhcalc = zeros(3000,length(Rs));
allhguess1 = zeros(3000,length(Rs));
%Y = 2;
%bigY=10:100/length(Rs):Y;
 
 
%for c=1:length(Rs) % Plot undeformed initial separation
 %YvsR(1,c)=31.023*Rs(c)^2+hinitial; 
%end

YvsR(1,:)=[0.000002366
2.36611E-06
2.36646E-06
2.36703E-06
2.36783E-06
2.36886E-06
2.37011E-06
2.3716E-06
2.37331E-06
2.37526E-06
2.37743E-06
2.37983E-06
2.38246E-06
2.38531E-06
2.3884E-06
2.39171E-06
2.39526E-06
2.39903E-06
2.40303E-06
2.40726E-06
2.41171E-06
2.4164E-06
2.42131E-06
2.42646E-06
2.43183E-06
2.43743E-06
2.44326E-06
2.44931E-06
2.4556E-06
2.46211E-06
2.46886E-06
2.47583E-06
2.48303E-06
2.49046E-06
2.49811E-06
0.000002506
2.51411E-06
2.52246E-06
2.53103E-06
2.53983E-06
2.54886E-06
2.55811E-06
2.5676E-06
2.57731E-06
2.58726E-06
2.59743E-06
2.60783E-06
2.61846E-06
2.62931E-06
2.6404E-06
2.65171E-06
2.66326E-06
2.67503E-06
2.68703E-06
2.69926E-06
2.71171E-06
2.7244E-06
2.73731E-06
2.75046E-06
2.76383E-06
2.77743E-06
2.79126E-06
2.80531E-06
2.8196E-06
2.83411E-06
2.84886E-06
2.86383E-06
2.87903E-06
2.89446E-06
2.91011E-06
0.000002926
2.94211E-06
2.95846E-06
2.97503E-06
2.99183E-06
3.00886E-06
3.02611E-06
3.0436E-06
3.06131E-06
3.07926E-06
3.09743E-06
3.11583E-06
3.13446E-06
3.15331E-06
3.1724E-06
3.19171E-06
3.21126E-06
3.23103E-06
3.25103E-06
3.27126E-06
3.29171E-06
3.3124E-06
3.33331E-06
3.35446E-06
3.37583E-06
3.39743E-06
3.41926E-06
3.44131E-06
3.4636E-06
3.48611E-06
3.50886E-06
3.53183E-06
3.55503E-06
3.57846E-06
3.60211E-06
0.000003626
3.65011E-06
3.67446E-06
3.69903E-06
3.72383E-06
3.74886E-06
3.77411E-06
3.7996E-06
3.82531E-06
3.85126E-06
3.87743E-06
3.90383E-06
3.93046E-06
3.95731E-06
3.9844E-06
4.01171E-06
4.03926E-06
4.06703E-06
4.09503E-06
4.12326E-06
4.15171E-06
4.1804E-06
4.20931E-06
4.23846E-06
4.26783E-06
4.29743E-06
4.32726E-06
4.35731E-06
4.3876E-06
4.41811E-06
4.44886E-06
4.47983E-06
4.51103E-06
4.54246E-06
4.57411E-06
0.000004606
4.63811E-06
4.67046E-06
4.70303E-06
4.73583E-06
4.76886E-06
4.80211E-06
4.8356E-06
4.86931E-06
4.90326E-06
4.93743E-06
4.97183E-06
5.00646E-06
5.04131E-06
5.0764E-06
5.11171E-06
5.14726E-06
5.18303E-06
5.21903E-06
5.25526E-06
5.29171E-06
5.3284E-06
5.36531E-06
5.40246E-06
5.43983E-06
5.47743E-06
5.51526E-06
5.55331E-06
5.5916E-06
5.63011E-06
5.66886E-06
5.70783E-06
5.74703E-06
5.78646E-06
5.82611E-06
0.000005866
5.90611E-06
5.94646E-06
5.98703E-06
6.02783E-06
6.06886E-06
6.11011E-06
6.1516E-06
6.19331E-06
6.23526E-06
6.27743E-06
6.31983E-06
6.36246E-06
6.40531E-06
6.4484E-06
6.49171E-06
6.53526E-06
6.57903E-06
6.62303E-06
6.66726E-06
6.71171E-06
6.7564E-06
6.80131E-06
6.84646E-06
6.89183E-06
6.93743E-06
6.98326E-06
7.02931E-06
7.0756E-06
7.12211E-06
7.16886E-06
7.21583E-06
7.26303E-06
7.31046E-06
7.35811E-06
0.000007406
7.45411E-06
7.50246E-06
7.55103E-06
7.59983E-06
7.64886E-06
7.69811E-06
7.7476E-06
7.79731E-06
7.84726E-06
7.89743E-06
7.94783E-06
7.99846E-06
8.04931E-06
8.1004E-06
8.15171E-06
8.20326E-06
8.25503E-06
8.30703E-06
8.35926E-06
8.41171E-06
8.4644E-06
8.51731E-06
8.57046E-06
8.62383E-06
8.67743E-06
8.73126E-06
8.78531E-06
8.8396E-06
8.89411E-06
8.94886E-06
9.00383E-06
9.05903E-06
9.11446E-06
9.17011E-06
0.000009226
9.28211E-06
9.33846E-06
9.39503E-06
9.45183E-06
9.50886E-06
9.56611E-06
9.6236E-06
9.68131E-06
9.73926E-06
9.79743E-06
9.85583E-06
9.91446E-06
9.97331E-06
1.00324E-05
1.00917E-05
1.01513E-05
1.0211E-05
1.0271E-05
1.03313E-05
1.03917E-05
1.04524E-05
1.05133E-05
1.05745E-05
1.06358E-05
1.06974E-05
1.07593E-05
1.08213E-05
1.08836E-05
1.09461E-05
1.10089E-05
1.10718E-05
1.1135E-05
1.11985E-05
1.12621E-05
0.000011326
1.13901E-05
1.14545E-05
1.1519E-05
1.15838E-05
1.16489E-05
1.17141E-05
1.17796E-05
1.18453E-05
1.19113E-05
1.19774E-05
1.20438E-05
1.21105E-05
1.21773E-05
1.22444E-05
1.23117E-05
1.23793E-05
1.2447E-05
1.2515E-05
1.25833E-05
1.26517E-05
1.27204E-05
1.27893E-05
1.28585E-05
1.29278E-05
1.29974E-05
1.30673E-05
1.31373E-05
1.32076E-05
1.32781E-05
1.33489E-05
1.34198E-05
1.3491E-05
1.35625E-05
1.36341E-05
0.000013706
1.37781E-05
1.38505E-05
1.3923E-05
1.39958E-05
1.40689E-05
1.41421E-05
1.42156E-05
1.42893E-05
1.43633E-05
1.44374E-05
1.45118E-05
1.45865E-05
1.46613E-05
1.47364E-05
1.48117E-05
1.48873E-05
1.4963E-05
1.5039E-05
1.51153E-05
1.51917E-05
1.52684E-05
1.53453E-05
1.54225E-05
1.54998E-05
1.55774E-05
1.56553E-05
1.57333E-05
1.58116E-05
1.58901E-05
1.59689E-05
1.60478E-05
1.6127E-05
1.62065E-05
1.62861E-05
0.000016366
1.64461E-05
1.65265E-05
1.6607E-05
1.66878E-05
1.67689E-05
1.68501E-05
1.69316E-05
1.70133E-05
1.70953E-05
1.71774E-05
1.72598E-05
1.73425E-05
1.74253E-05
1.75084E-05
1.75917E-05
1.76753E-05
1.7759E-05
1.7843E-05
1.79273E-05
1.80117E-05
1.80964E-05
1.81813E-05
1.82665E-05
1.83518E-05
1.84374E-05
1.85233E-05
1.86093E-05
1.86956E-05
1.87821E-05
1.88689E-05
1.89558E-05
1.9043E-05
1.91305E-05
1.92181E-05
0.000019306
1.93941E-05
1.94825E-05
1.9571E-05
1.96598E-05
1.97489E-05
1.98381E-05
1.99276E-05
2.00173E-05
2.01073E-05
2.01974E-05
2.02878E-05
2.03785E-05
2.04693E-05
2.05604E-05
2.06517E-05
2.07433E-05
2.0835E-05
2.0927E-05
2.10193E-05
2.11117E-05
2.12044E-05
2.12973E-05
2.13905E-05
2.14838E-05
2.15774E-05
2.16713E-05
2.17653E-05
2.18596E-05
2.19541E-05
2.20489E-05
2.21438E-05
2.2239E-05
2.23345E-05
2.24301E-05
0.000022526
2.26221E-05
2.27185E-05
2.2815E-05
2.29118E-05
2.30089E-05
2.31061E-05
2.32036E-05
2.33013E-05
2.33993E-05
2.34974E-05
2.35958E-05
2.36945E-05
2.37933E-05
2.38924E-05
2.39917E-05
2.40913E-05
2.4191E-05
2.4291E-05
2.43913E-05
2.44917E-05
2.45924E-05
2.46933E-05
2.47945E-05
2.48958E-05
2.49974E-05
2.50993E-05
2.52013E-05
2.53036E-05
2.54061E-05
2.55089E-05
2.56118E-05
2.5715E-05
2.58185E-05
2.59221E-05
0.000026026
2.61301E-05
2.62345E-05
2.6339E-05
2.64438E-05
2.65489E-05
2.66541E-05
2.67596E-05
2.68653E-05
2.69713E-05
2.70774E-05
2.71838E-05
2.72905E-05
2.73973E-05
2.75044E-05
2.76117E-05
2.77193E-05
2.7827E-05
2.7935E-05
2.80433E-05
2.81517E-05
2.82604E-05
2.83693E-05
2.84785E-05
2.85878E-05
2.86974E-05
2.88073E-05
2.89173E-05
2.90276E-05
2.91381E-05
2.92489E-05
2.93598E-05
2.9471E-05
2.95825E-05
2.96941E-05
0.000029806
2.99181E-05
3.00305E-05
3.0143E-05
3.02558E-05
3.03689E-05
3.04821E-05
3.05956E-05
3.07093E-05
3.08233E-05
3.09374E-05
3.10518E-05
3.11665E-05
3.12813E-05
3.13964E-05
3.15117E-05
3.16273E-05
3.1743E-05
3.1859E-05
3.19753E-05
3.20917E-05
3.22084E-05
3.23253E-05
3.24425E-05
3.25598E-05
3.26774E-05
3.27953E-05
3.29133E-05
3.30316E-05
3.31501E-05
3.32689E-05
3.33878E-05
3.3507E-05
3.36265E-05
3.37461E-05
0.000033866
3.39861E-05
3.41065E-05
3.4227E-05
3.43478E-05
3.44689E-05
3.45901E-05
3.47116E-05
3.48333E-05
3.49553E-05
3.50774E-05
3.51998E-05
3.53225E-05
3.54453E-05
3.55684E-05
3.56917E-05
3.58153E-05
3.5939E-05
3.6063E-05
3.61873E-05
3.63117E-05
3.64364E-05
3.65613E-05
3.66865E-05
3.68118E-05
3.69374E-05
3.70633E-05
3.71893E-05
3.73156E-05
3.74421E-05
3.75689E-05
3.76958E-05
3.7823E-05
3.79505E-05
3.80781E-05
0.000038206
3.83341E-05
3.84625E-05
3.8591E-05
3.87198E-05
3.88489E-05
3.89781E-05
3.91076E-05
3.92373E-05
3.93673E-05
3.94974E-05
3.96278E-05
3.97585E-05
3.98893E-05
4.00204E-05
4.01517E-05
4.02833E-05
4.0415E-05
4.0547E-05
4.06793E-05
4.08117E-05
4.09444E-05
4.10773E-05
4.12105E-05
4.13438E-05
4.14774E-05
4.16113E-05
4.17453E-05
4.18796E-05
4.20141E-05
4.21489E-05
4.22838E-05
4.2419E-05
4.25545E-05
4.26901E-05
0.000042826
4.29621E-05
4.30985E-05
4.3235E-05
4.33718E-05
4.35089E-05
4.36461E-05
4.37836E-05
4.39213E-05
4.40593E-05
4.41974E-05
4.43358E-05
4.44745E-05
4.46133E-05
4.47524E-05
4.48917E-05
4.50313E-05
4.5171E-05
4.5311E-05
4.54513E-05
4.55917E-05
4.57324E-05
4.58733E-05
4.60145E-05
4.61558E-05
4.62974E-05
4.64393E-05
4.65813E-05
4.67236E-05
4.68661E-05
4.70089E-05
4.71518E-05
4.7295E-05
4.74385E-05
4.75821E-05
0.000047726
4.78701E-05
4.80145E-05
4.8159E-05
4.83038E-05
4.84489E-05
4.85941E-05
4.87396E-05
4.88853E-05
4.90313E-05
4.91774E-05
4.93238E-05
4.94705E-05
4.96173E-05
4.97644E-05
4.99117E-05
5.00593E-05
5.0207E-05
5.0355E-05
5.05033E-05
5.06517E-05
5.08004E-05
5.09493E-05
5.10985E-05
5.12478E-05
5.13974E-05
5.15473E-05
5.16973E-05
5.18476E-05
5.19981E-05
5.21489E-05
5.22998E-05
5.2451E-05
5.26025E-05
5.27541E-05
0.000052906
5.30581E-05
5.32105E-05
5.3363E-05
5.35158E-05
5.36689E-05
5.38221E-05
5.39756E-05
5.41293E-05
5.42833E-05
5.44374E-05
5.45918E-05
5.47465E-05
5.49013E-05
5.50564E-05
5.52117E-05
5.53673E-05
5.5523E-05
5.5679E-05
5.58353E-05
5.59917E-05
5.61484E-05
5.63053E-05
5.64625E-05
5.66198E-05
5.67774E-05
5.69353E-05
5.70933E-05
5.72516E-05
5.74101E-05
5.75689E-05
5.77278E-05
5.7887E-05
5.80465E-05
5.82061E-05
0.000058366
5.85261E-05
5.86865E-05
5.8847E-05
5.90078E-05
5.91689E-05
5.93301E-05
5.94916E-05
5.96533E-05
5.98153E-05
5.99774E-05
6.01398E-05
6.03025E-05
6.04653E-05
6.06284E-05
6.07917E-05
6.09553E-05
6.1119E-05
6.1283E-05
6.14473E-05
6.16117E-05
6.17764E-05
6.19413E-05
6.21065E-05
6.22718E-05
6.24374E-05
6.26033E-05
6.27693E-05
6.29356E-05
6.31021E-05
6.32689E-05
6.34358E-05
6.3603E-05
6.37705E-05
6.39381E-05
0.000064106
6.42741E-05
6.44425E-05
6.4611E-05
6.47798E-05
6.49489E-05
6.51181E-05
6.52876E-05
6.54573E-05
6.56273E-05
6.57974E-05
6.59678E-05
6.61385E-05
6.63093E-05
6.64804E-05
6.66517E-05
6.68233E-05
6.6995E-05
6.7167E-05
6.73393E-05
6.75117E-05
6.76844E-05
6.78573E-05
6.80305E-05
6.82038E-05
6.83774E-05
6.85513E-05
6.87253E-05
6.88996E-05
6.90741E-05
6.92489E-05
6.94238E-05
6.9599E-05
6.97745E-05
6.99501E-05
0.000070126
7.03021E-05
7.04785E-05
7.0655E-05
7.08318E-05
7.10089E-05
7.11861E-05
7.13636E-05
7.15413E-05
7.17193E-05
7.18974E-05
7.20758E-05
7.22545E-05
7.24333E-05
7.26124E-05
7.27917E-05
7.29713E-05
7.3151E-05
7.3331E-05
7.35113E-05
7.36917E-05
7.38724E-05
7.40533E-05
7.42345E-05
7.44158E-05
7.45974E-05
7.47793E-05
7.49613E-05
7.51436E-05
7.53261E-05
7.55089E-05
7.56918E-05
7.5875E-05
7.60585E-05
7.62421E-05
0.000076426
7.66101E-05
7.67945E-05
7.6979E-05
7.71638E-05
7.73489E-05
7.75341E-05
7.77196E-05
7.79053E-05
7.80913E-05
7.82774E-05
7.84638E-05
7.86505E-05
7.88373E-05
7.90244E-05
7.92117E-05
7.93993E-05
7.9587E-05
7.9775E-05
7.99633E-05
8.01517E-05
8.03404E-05
8.05293E-05
8.07185E-05
8.09078E-05
8.10974E-05
8.12873E-05
8.14773E-05
8.16676E-05
8.18581E-05
8.20489E-05
8.22398E-05
8.2431E-05
8.26225E-05
8.28141E-05
0.000083006
8.31981E-05
8.33905E-05
8.3583E-05
8.37758E-05
8.39689E-05
8.41621E-05
8.43556E-05
8.45493E-05
8.47433E-05
8.49374E-05
8.51318E-05
8.53265E-05
8.55213E-05
8.57164E-05
8.59117E-05
8.61073E-05
8.6303E-05
8.6499E-05
8.66953E-05
8.68917E-05
8.70884E-05
8.72853E-05
8.74825E-05
8.76798E-05
8.78774E-05
8.80753E-05
8.82733E-05
8.84716E-05
8.86701E-05
8.88689E-05
8.90678E-05
8.9267E-05
8.94665E-05
8.96661E-05
0.000089866
9.00661E-05
9.02665E-05
9.0467E-05
9.06678E-05
9.08689E-05
9.10701E-05
9.12716E-05
9.14733E-05
9.16753E-05
9.18774E-05
9.20798E-05
9.22825E-05
9.24853E-05
9.26884E-05
9.28917E-05
9.30953E-05
9.3299E-05
9.3503E-05
9.37073E-05
9.39117E-05
9.41164E-05
9.43213E-05
9.45265E-05
9.47318E-05
9.49374E-05
9.51433E-05
9.53493E-05
9.55556E-05
9.57621E-05
9.59689E-05
9.61758E-05
9.6383E-05
9.65905E-05
9.67981E-05
0.000097006
9.72141E-05
9.74225E-05
9.7631E-05
9.78398E-05
9.80489E-05
9.82581E-05
9.84676E-05
9.86773E-05
9.88873E-05
9.90974E-05
9.93078E-05
9.95185E-05
9.97293E-05
9.99404E-05
0.000100152
0.000100363
0.000100575
0.000100787
0.000100999
0.000101212
0.000101424
0.000101637
0.00010185
0.000102064
0.000102277
0.000102491
0.000102705
0.00010292
0.000103134
0.000103349
0.000103564
0.000103779
0.000103994
0.00010421
0.000104426
0.000104642
0.000104858
0.000105075
0.000105292
0.000105509
0.000105726
0.000105944
0.000106161
0.000106379
0.000106597
0.000106816
0.000107034
0.000107253
0.000107472
0.000107692
0.000107911
0.000108131
0.000108351
0.000108571
0.000108792
0.000109012
0.000109233
0.000109454
0.000109676
0.000109897
0.000110119
0.000110341
0.000110564
0.000110786
0.000111009
0.000111232
0.000111455
0.000111678
0.000111902
0.000112126
0.00011235
0.000112574
0.000112799
0.000113024
0.000113249
0.000113474
0.0001137
0.000113925
0.000114151
0.000114377
0.000114604
0.00011483
0.000115057
0.000115284
0.000115512
0.000115739
0.000115967
0.000116195
0.000116423
0.000116652
0.00011688
0.000117109
0.000117338
0.000117568
]'; 
indexer=2;
ho=YvsR(1,:);
allhvst(1,:) = ho;
time=time+tincre;
hguess1=ho;
hcalc=ho;
hpreviousSol=ho;
calcint = zeros(1,length(Rs));
dhdt1 = zeros(1,length(Rs)); 
fittinginside = zeros(1,length(Rs));
inside = zeros(1,length(Rs));
ecalc = zeros(1,length(Rs));
peguess = zeros(1,length(Rs));
eguess = zeros(1,length(Rs));



syms ksi;
r = Rs;

inc = 100;
maxlength = 100000;
range = 1:inc:maxlength;
%Z = @(ksi) -ksi*trapz(r,r.*p.*besselj(0,ksi*r)); % maybe spline here
Z = zeros(1,maxlength/inc);




while time<60 %The outer loop, when the loop execute once one certain time separation was determined
epreviousSol=ecalc; 
hpreviousSol=hcalc;
if min(hcalc) < 10e-9
    break
end


criteriacount = 0;
if indexer > 2 % This if statement is for the updating initialize dh.
    hguess1=2*hcalc - allhvst(indexer-2,:);
else 
    hguess1=2*hcalc - allhvst(indexer-1,:);
end 
    

criteria=false;

runs=1;
while criteria==false% The inner loop
dhdt1=(hguess1-hpreviousSol)./tincre;


%RsScale=Rs*1E3;
%dhdt1Scale=dhdt1*1E9;
%fitdhdt=polyfit(RsScale,dhdt1Scale,3);
%fitdhdt=[fitdhdt(1) fitdhdt(2)./1E3 fitdhdt(3)./1E6 fitdhdt(4)./1E9];
%dp1finder=-12*eta*(fitdhdt(1)*Rs.^4./5+fitdhdt(2)*Rs.^3./4+fitdhdt(3)*Rs.^2./3+...
    %fitdhdt(4).*Rs./2)./(hguess1.^3)*(Rs(2)-Rs(1));   


inside = dhdt1.*Rs;
fittinginside = spline(Rs,inside);

integ = fnint(fittinginside);
calcint = fnval(integ,Rs);

for a = 1:length(p1guess)
   dp1finder(a) = -12*eta*calcint(a)/(Rs(a)*hguess1(a)^3);
   dp1finder(1) = 0;
end
%dp1finder = -12*eta*calcint./(Rs.*hguess1.^3);

%p1guessfunc = fnint(dp1finder);
%p1guess = fnval(p1guessfunc);
for a=length(p1guess)-1:-1:1
    %dp1finder(a) = -12*eta*calcint(a)/(Rs(a)*hguess1(a)^3)*(Rs(a+1)-Rs(a));
    %dp1finder(1) = 0;
    %dhdtlocal = [dhdt1(a),dhdt1(a+1)];
    %Rslocal = [Rs(a),Rs(a+1)];
    %fitdhdt = polyfit(Rslocal,dhdtlocal,1);
    %dp1finder(a) = -12*eta*(1/3*fitdhdt(1))
p1guess(a)=p1guess(a+1)+((dp1finder(a)+dp1finder(a+1))/2)*(Rs(a+1)-Rs(a));%edge is zero, matrix of dp converted to pressure profile


end

p1guess(1) = p1guess(2);

%I0=pi/2*trapz(Rs,p1guess);
force=trapz(Rs,2*pi*Rs.*p1guess);
%for a=1:length(Rs)
 
 
%Itail=-p1guess(a)*(pi*Rs(a)^2./(8*Y));%?
%dummyp=zeros(1,length(Rs));
%dummyp=peguess;
%c=4*Rs(a)*Rs;
%d=((Rs+Rs(a)).^2);
%phi1=Rs./(Rs+Rs(a)).*ellipke(c./d);
%phi1(a)=pi/2;
%Ir=trapz(Rs,(dummyp-peguess(a)).*(phi1-pi/2));%?
%wguess(a)=4*(1-poi^2)/(pi*E)*(I0+Ir);%
%end
% from dummy p =... to wguess(a): determine deformation from pe.
% to update for layering effects, uncomment following code and comment
% above code.

p = p1guess;
for i = 1:inc:maxlength
    Z(1,(i+inc-1)/inc) = -1 * i*trapz(r,r.*p.*besselj(0,i*r));
end




A = @(ksi) [(lambda+miu)*ksi miu -1*(lambda+miu)*ksi miu;
    (lambda+miu)*ksi -1*lambda (lambda+miu)*ksi lambda;
    -1*ksi.*exp(-1*ksi*h) exp(-1*ksi*h)-h*ksi.*exp(-1*ksi*h) ksi.*exp(ksi*h) exp(ksi*h)+h*ksi.*exp(ksi*h);
    ((lambda+miu)*ksi.*exp(-1*ksi*h))/miu (2+(lambda+miu)*h*ksi/miu).*exp(-1*ksi*h) ((lambda+miu)*ksi/miu).*exp(ksi*h) (-2+(lambda+miu)*h*ksi/miu).*exp(ksi*h)];

B = @(ksi) [Z(1, (ksi+99)/100)/(2*(ksi.^3)); 0; 0; 0];

coeff = zeros(4, maxlength/inc);
format shortEng
for i = 1:inc:maxlength
    coeff(:, (i+inc-1)/inc) = (A(i))\B(i);
end
%ratio = zeros(1,length(r));


for j = 1:length(r)
    u = range.*(coeff(1,:).*(range.^2)+coeff(3,:).*(range.^2)-2*coeff(2,:).*range+2*coeff(4,:).*range-(lambda+2*miu)*(coeff(1,:)+coeff(3,:)).*(range.^2)/miu).*besselj(0,range.*r(1,j));
    wguess(1,j) = trapz(range,u);
   % uLast10 = u(0.9*maxlength/inc:maxlength/inc);
    
    %ratio(1,j) = max(uLast10)/max(final(1,j));
  
   % if ratio(1,j) > 0.01
        %plot(range,u)
        %break
    %end
end






%if indexer==2
    %v = 0.286/0.5*v
%else
    %v = -350E-9

%end
hcalc=force/k+v*time+ho+wguess;



if max(abs(hcalc-hguess1))< 1E-10
    criteria=true;
    allruns(indexer,1) = runs;
    ratio = maxratio;
    

else
  
allhcalc(runs,:) = hcalc;   
allhguess1(runs,:) = hguess1;

hguess1=hguess1*ratio+hcalc*(1-ratio);   
if runs > 2
if hguess1 > allhguess1(runs-1,:) > allhguess1(runs,:)
    ratio = ratio + (1-ratio)*0.1;
    hguess1=allhguess1(runs,:)*ratio+allhcalc(runs,:)*(1-ratio);
    criteriacount = 0;
elseif hguess1 < allhguess1(runs-1,:) < allhguess1(runs,:)
    ratio = ratio + (1-ratio)*0.1;
    hguess1=allhguess1(runs,:)*ratio+allhcalc(runs,:)*(1-ratio);
    criteriacount = 0;
else
    criteriacount = criteriacount +1;


end
maxratio = max(ratio, maxratio);

if (criteriacount > 50) && (max(abs(hcalc-hguess1)) < 3e-10) 
    ratio = (ratio-0.1)/0.9;
    criteriacount = 0;
end
else 
end

    

  %  elseif indexer>30
   %     hguess1=hguess1*0.9999+hcalc*0.0001; 
    %elseif indexer>40
       % hguess1=hguess1*0.99999+hcalc*0.00001; 
   % elseif indexer>80
       % hguess1=hguess1*0.999999+hcalc*0.000001;  
   % elseif indexer<20
     %  hguess1=hguess1*0.9999999+hcalc*0.0000001;    
   % subplot(1,4,3)

   % plot(Rs,allhcalc(runs,:)-allhguess1(runs,:))
    %title(num2str(ratio));
    %axis([0 0.002 -1e-9 1e-9])
    %drawnow    
    
    runs=runs+1;
    
   % subplot(1,4,2)
    %hold on
    %plot(Rs,hguess1,'red')
   % plot(Rs,hcalc,'blue')
    %axis([0 100e-6 0e-9 3000e-9])
    %title(num2str(runs))
   % drawnow
    if runs > 10000
        break
    end
  
    
    %dhdtfitreal = fitdhdt(1)*Rs.^5+fitdhdt(2)*Rs.^4+fitdhdt(3)*Rs.^3+fitdhdt(4)*Rs.^2+fitdhdt(5)*Rs+ fitdhdt(6);
    %subplot(1,4,4)
    
   % plot(Rs,dhdt1,'*-')
    %hold on
    %fnplt(fittingdhdt1,'red')
   % axis([0 Rs(40) -72E-9 5E-9])
    %hold on
   % drawnow
    
    
end

end
%cla(subplot(1,4,2))
%cla(subplot(1,4,3))
%subplot(1,4,1)
%hold on
%plot(Rs,hcalc)
%axis([0 250e-6 0 3500e-9])
%title(num2str(indexer));
%drawnow

%subplot(1,4,4) 
%hold on 
%plot(Rs,peguess./p1guess)
%axis([0 250e-6 0 1])
%title(num2str(thicknessmax(qw)));
%drawnow 
ecalc=eguess ; 
allforce(indexer,1)=force;
allhvst(indexer,:)=hcalc;
allpvst(indexer,:)=p1guess;
allwvst(indexer,:)=wguess;

allruns(indexer,:)=runs;
time=time+tincre;

qws = num2str(thicknessmax);
qwsstring = strcat(qws,'.xlsx');





%plot(Rs,hcalc,'x-')
%axis([0 Rs(20) 0 hinitial*3])
%drawnow
%allhvst(indexer,:)=hcalc;
indexer=indexer+1;
%time=time+tincre;

if runs > 10000
        break
end
end


clf
xlswrite(qwsstring,allhvst,1)
xlswrite(qwsstring,allpvst,2)
xlswrite(qwsstring,allwvst,3)
xlswrite(qwsstring,allforce,4)
xlswrite(qwsstring,allruns,5)



end